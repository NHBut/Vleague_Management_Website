@{
    ViewData["Title"] = "TranDauCauThu";
    Layout = "~/Areas/Admin/Views/Shared/_Layout_Admin.cshtml";
}

<div class="page-header">
    <h3 class="page-title"> Quản lý trận đấu cầu thủ </h3>
    
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">Trang chủ</a></li>
            <li class="breadcrumb-item active" aria-current="page">Trận đấu</li>
        </ol>
    </nav>
</div>
<div class="row">
    <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Danh sách thông số cầu thủ trong trận đấu</h4>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>ID trận đấu</th>
                            <th>ID cầu thủ </th>
                            <th>Thời gian bắt đầu</th>
                            <th>Thời gian kết thúc</th>
                            <th>Phạm lỗi</th>
                            <th>Thẻ vàng</th>
                            <th>Thẻ đỏ</th>
                            
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="tbody-trandaucauthu">
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <div class="col-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Trận đấu - cầu thủ</h4>
                <p class="card-description" id="card-action"></p>
                <form class="forms-sample" id="form-trandaucauthu">
                    <div class="form-group">
                        <label for="TranDauId">Mã trận đấu</label>
                        <input type="text" class="form-control" id="trandauid" placeholder="Mã trận đấu">
                    </div>
                    <div class="form-group">
                        <label for="cauthu">Mã cầu thủ</label>
                        <input type="text" class="form-control" id="cauthuid" placeholder=cauthuid" />
                    </div>
                    <div class="form-group">
                        <label for="thoigianbatdau"></label>
                        <input type="text" class="form-control" id="thoigianbatdau" placeholder=thoigianvaosan">
                    </div>
                    <div class="form-group">
                        <label for="thoigianketthuc"></label>
                        <input type="text" class="form-control" id="thoigianketthuc" placeholder="Out time">
                    </div>
                    <div class="form-group">
                        <label for="phamloi"></label>
                        <input type="text" class="form-control" id="phamloi" placeholder="SoLanPhamLoi">
                    </div>
                    <div class="form-group">
                        <label for="TheVang"></label>
                        <input type="text" class="form-control" id="thevang" placeholder="TheVang">
                    </div>
                    <div class="form-group">
                        <label for="TheDo"></label>
                        <input type="text" class="form-control" id="thedo" placeholder="TheDo">
                    </div>
                    <button class="btn btn-gradient-primary me-2" onclick="InsertTranDauCauThu()">Thêm</button>
                    <button class="btn btn-gradient-primary me-2" onclick="Update()">Cập nhật</button>
                    
                </form>
            </div>
        </div>
    </div>
</div>




<script>

    $(document).ready(function () {
        getAllTrandaucauthu();
    });

    function getAllTrandaucauthu() {
            $.ajax({
            url: "https://localhost:7239/api/APITranDauCauThu?pageSize=10&pagenumber=1",
            method: 'GET',
            contentType: 'json',
            dataType: 'json',
            error: function (response) {
                console.log("error");
            },
            success: function (response) {
                const len = response.length;
                let table = '';
                for (var i = 0; i < len; ++i) {
                    table = table + '<tr>';
                    table = table + '<td>' + response[i].tranDauId.trim() + '</td>';
                    table = table + '<td>' + response[i].cauThuId + '</td>';
                    table = table + '<td>' + response[i].thoiGianBatDau + '</td>';
                    table = table + '<td>' + response[i].thoiGianKetThuc + '</td>';
                    table = table + '<td>' + response[i].phamLoi + '</td>';
                    table = table + '<td>' + response[i].theVang + '</td>';
                    table = table + '<td>' + response[i].theDo + '</td>';
                    table = table + '<td>' + ' <button type="button" class="btn btn-gradient-info btn-rounded btn-icon" onclick="updateTranDauFill(\'' + response[i].tranDauId.trim() + '\',\'' + response[i].cauThuId.trim() + '\')"><i class="mdi mdi-table-edit"></i></button> ' + '</td>';

                    table += '<td>' +
                        '<button type="button" class="btn btn-gradient-danger btn-rounded btn-icon" onclick="deleteTranDau(\'' + response[i].tranDauId.trim() + '\',\'' + response[i].cauThuId.trim() + '\')">' +
                        '<i class="mdi mdi-delete-forever"></i>' +
                        '</button>' +
                        '</td>';
                }
                document.getElementById('tbody-trandaucauthu').innerHTML = table;
            },
            fail: function (response) {
                console.log("fail");
            }
        });
    }

    function deleteTranDau(trandauid, cauthuid) {
        var url = 'https://localhost:7239/api/APITranDauCauThu?trandauid=' + trandauid + '&cauthuid=' + cauthuid;
        $.ajax({
            url: url,
            method: 'DELETE',
            contentType: 'json',
            dataType: 'json',
            error: function (xhr, textStatus, errorThrown) {
                alert("Xóa không thành công: " + xhr.responseText);
            },
            success: function (response) {
                alert("Xóa thành công");
                getAllTrandaucauthu();
            }
        });
    }
    function updateTranDauFill(trandauid, cauthuid) {
        var url = 'https://localhost:7239/api/APITranDauCauThu/getById?trandauid='+  trandauid+ '&cauthuid=' + cauthuid;
        $.ajax({
            url: url,
            method: 'GET',
            contentType: 'json',
            dataType: 'json',
            error: function (response) {
                alert("Cập nhật không thành công");
            },
            success: function (response) {
                $("#trandauid").val(response.tranDauId)
                $("#cauthuid:text").val(response.cauThuId)
                $("#thoigianbatdau").val(response.thoiGianBatDau)
                $("#thoigianketthuc").val(response.thoiGianKetThuc)
                $("#phamloi").val(response.phamLoi)
                $("#thevang").val(response.theVang)
                $("#thedo").val(response.theDo)
            }
        });
    }


    function Update() {
        var dataSend = {
            TranDauId: $("#trandauid").val(),
            CauThuId: $("#cauthuid").val(),
            ThoiGianBatDau: $("#thoigianbatdau").val(),
            ThoiGianKetThuc: $("#thoigianketthuc").val(),
            PhamLoi: $("#phamloi").val(),
            TheVang: parseInt($("#thevang").val()),
            TheDo: parseInt($("#thedo").val())
        }
        var url = 'https://localhost:7239/api/APITranDauCauThu';
        $.ajax({
            url: url,
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(dataSend),
            dataType: 'json',
            error: function (response) {
                alert("Cập nhật không thành công");
            },
            success: function (response) {
                alert("Cập nhật thành công");
                
                getAllTrandaucauthu();
            }
        });
    }

    function InsertTranDauCauThu() {

        var dataSend = {
            TranDauId: $("#trandauid").val(),
            CauThuId: $("#cauthuid").val(),
            ThoiGianBatDau: $("#thoigianbatdau").val(),
            ThoiGianKetThuc: $("#thoigianketthuc").val(),
            PhamLoi: $("#phamloi").val(),
            TheVang: parseInt($("#thevang").val()),
            TheDo: parseInt($("#thedo").val())
        }
        var url = 'https://localhost:7239/api/APITranDauCauThu';
        $.ajax({
            url: url,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(dataSend),
            dataType: 'json',
            error: function (error) {
                alert(JSON.stringify(error))
            },
            success: function (response) {
                alert("Thêm mới thành công");
                resetInput()
                getAllTrandau(); //Gọi đến hàm lấy dữ liệu lên bảng
            }
        });
    }
    function resetInput() {
        $("#trandauid:text").val("")
        $("#cauthuid:text").val("")
        $("#thoigianbatdau:text").val("")
        $("#thoigianketthuc:text").val("")
        $("#phamloi:text").val("")
        $("#thevang:text").val("")
        $("#thedo:text").val("")
    }

</script>

